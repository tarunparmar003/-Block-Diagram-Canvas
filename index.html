<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Electronics Block Diagram Generator</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  display: flex;
  height: 100vh;
  background: linear-gradient(135deg, #0f4c81, #1e6fbf);
}

#sidebar {
  width: 300px;
  padding: 18px;
}

.glass {
  backdrop-filter: blur(14px);
  background: rgba(30,111,191,0.35);
  border-radius: 18px;
  box-shadow: 0 15px 40px rgba(0,0,0,0.3);
  border: 1px solid rgba(255,255,255,0.25);
}

textarea {
  width: 100%;
  height: 80px;
  border-radius: 10px;
  border: none;
  padding: 8px;
}

button {
  margin-top: 12px;
  width: 100%;
  padding: 12px;
  border: none;
  border-radius: 14px;
  background: linear-gradient(135deg, #00f2fe, #4facfe);
  color: #fff;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 10px 30px rgba(0,180,255,0.6);
  transition: all 0.25s ease;
}

button:hover {
  transform: translateY(-3px) scale(1.04);
  box-shadow: 0 18px 50px rgba(0,180,255,0.9);
}

button:active {
  transform: scale(0.95);
}

#canvasContainer {
  flex: 1;
  position: relative;
  overflow: hidden;
}

.block {
  position: absolute;
  width: 220px;
  padding: 16px;
  border-radius: 18px;
  cursor: grab;
  color: #fff;
  background: linear-gradient(135deg,
    rgba(90,180,255,0.55),
    rgba(30,110,210,0.45)
  );
  backdrop-filter: blur(14px);
  border: 1px solid rgba(200,230,255,0.5);
  box-shadow: 0 18px 45px rgba(0,50,150,0.5);
  transition: all 0.3s ease;
}

.block:hover {
  transform: scale(1.06);
}

.block:active {
  cursor: grabbing;
}

.title {
  font-weight: bold;
  margin-bottom: 8px;
  text-transform: uppercase;
  letter-spacing: 0.6px;
}
</style>
</head>

<body>

<div id="sidebar" class="glass">
  <h3 style="color:white">Product Description</h3>
  <textarea id="prompt">Smart doorbell with camera and motion sensor</textarea>

  <button onclick="generateDiagram()">Generate Diagram</button>
  <button onclick="addBlock()">Add Block</button>
  <button onclick="removeBlock()">Remove Block</button>
  <button onclick="addConnection()">Add Connection</button>
  <button onclick="addAnnotation()">Add Annotation</button>
  <button onclick="exportJSON()">Export JSON</button>
  <button onclick="exportSVG()">Export SVG</button>
</div>

<div id="canvasContainer"></div>

<script>
let diagramData = { nodes: [], connections: [] };
let annotations = [];
let selectedBlock = null;

function generateDiagram() {
  diagramData = {
    nodes: [
      { id:'power', label:'Power Supply', components:['Battery'], x:80, y:80 },
      { id:'inputs', label:'Inputs Block', components:['Camera','Sensor'], x:80, y:300 },
      { id:'control', label:'Control & Processing', components:['MCU'], x:380, y:190 },
      { id:'outputs', label:'Outputs Block', components:['Speaker'], x:680, y:190 },
      { id:'peripherals', label:'Other Peripherals', components:['Wi-Fi'], x:380, y:420 }
    ],
    connections: [
      {from:'power',to:'control'},
      {from:'inputs',to:'control'},
      {from:'control',to:'outputs'},
      {from:'control',to:'peripherals'}
    ]
  };
  renderDiagram();
}

function renderDiagram() {
  const canvas = document.getElementById('canvasContainer');
  canvas.innerHTML = '';

  const svg = document.createElementNS("http://www.w3.org/2000/svg","svg");
  svg.style.width = "100%";
  svg.style.height = "100%";
  canvas.appendChild(svg);

  diagramData.connections.forEach(c=>{
    const f = diagramData.nodes.find(n=>n.id===c.from);
    const t = diagramData.nodes.find(n=>n.id===c.to);
    if(!f||!t) return;
    const line = document.createElementNS(svg.namespaceURI,"line");
    line.setAttribute("x1",f.x+220);
    line.setAttribute("y1",f.y+40);
    line.setAttribute("x2",t.x);
    line.setAttribute("y2",t.y+40);
    line.setAttribute("stroke","#00eaff");
    line.setAttribute("stroke-width","3");
    svg.appendChild(line);
  });

  diagramData.nodes.forEach(n=>{
    const d = document.createElement("div");
    d.className = "block";
    d.style.left = n.x+"px";
    d.style.top = n.y+"px";
    d.innerHTML = `<div class='title'>${n.label}</div>${n.components.join("<br>")}`;
    d.onclick = ()=>selectBlock(n,d);
    makeDraggable(d,n);
    canvas.appendChild(d);
  });
}

function makeDraggable(el,node){
  el.draggable=true;
  el.ondragstart=e=>{el.sx=e.clientX;el.sy=e.clientY;}
  el.ondragend=e=>{
    node.x+=e.clientX-el.sx;
    node.y+=e.clientY-el.sy;
    renderDiagram();
  }
}

function selectBlock(node,el){
  selectedBlock=node;
  document.querySelectorAll(".block").forEach(b=>b.style.outline="none");
  el.style.outline="3px solid #00eaff";
}

function addBlock(){
  const name=prompt("Block name?");
  if(!name) return;
  diagramData.nodes.push({
    id:name.toLowerCase().replace(/\s+/g,'-'),
    label:name,
    components:[],
    x:250,y:250
  });
  renderDiagram();
}

function removeBlock(){
  if(!selectedBlock) return alert("Select a block");
  diagramData.nodes=diagramData.nodes.filter(n=>n!==selectedBlock);
  diagramData.connections=diagramData.connections.filter(c=>c.from!==selectedBlock.id&&c.to!==selectedBlock.id);
  selectedBlock=null;
  renderDiagram();
}

function addConnection(){
  const f=prompt("From block id:");
  const t=prompt("To block id:");
  if(f&&t){diagramData.connections.push({from:f,to:t});renderDiagram();}
}

function addAnnotation(){
  if(!selectedBlock) return alert("Select a block");
  const txt=prompt("Annotation:");
  if(txt) annotations.push({target:selectedBlock.id,text:txt});
}

function exportJSON(){
  const data={...diagramData,annotations};
  const b=new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(b);
  a.download="diagram.json";
  a.click();
}

function exportSVG(){
  const svg=document.querySelector("svg");
  const s=new XMLSerializer().serializeToString(svg);
  const b=new Blob([s],{type:"image/svg+xml"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(b);
  a.download="diagram.svg";
  a.click();
}
</script>

</body>
</html>
